<html>

<head>
  <meta charset="utf-8" />
</head>

<body>
  <script>
    (() => { "use strict"; const t = () => Math.random().toString(16).substr(2), e = t => new Promise(((e, r) => { setTimeout((() => { e(void 0) }), t) })), r = (() => { const t = document.createElement("div"); return e => (t.innerText = e, t.innerHTML) })(), n = async (r, a = {}) => { if (Array.isArray(r)) { const [i, s, ...c] = r, u = Object.entries(s).reduce(((t, [e, r]) => ("$" === e[0] && (t[e] = r), t)), { ...a }), l = []; try { for (const t of c) l.push(await n(t, u)) } catch (t) { if (s.errorBoundary) return s.errorBoundary; throw t } if ("string" == typeof i) return [i, s, ...l]; const y = i({ ...u, ...s, children: l }); if (null === y || "object" != typeof y || Array.isArray(y)) return await n(y, u); let f; const h = async t => { do { await e(0) } while (t && !document.getElementById(f)); const r = document.getElementById(f); if (!r) return void await y.return(); const a = await y.next(r); if (a.done) return; const i = await n(a.value, u); if (!Array.isArray(i)) throw new Error(`Expect component to rerender a tag, not ${i}`); const [s, c, ...l] = i; if (s !== r.tagName.toLowerCase()) throw new Error(`Expect component to rerender with tag ${r.tagName.toLowerCase()}, not tag ${s}`); Object.assign(r, c); const d = {}; r.innerHTML = l.map((t => o(t, f, d))).join(" "), h(!1) }, d = await y.next(); if (d.done) return null; const m = await n(d.value, u); if (!Array.isArray(m)) throw new Error(`Expect component to return a tag, not ${m}`); const [, w] = m; return f = w.id || t(), w.id = f, h(!0), m } return r }, o = (e, n = "GLOBAL", a = {}) => { if (Array.isArray(e)) { const [r, u, ...l] = e, y = Object.fromEntries((s = ([e, r]) => { if ("on" !== e.substr(0, 2)) return [e, r]; { const o = e + "-" + t(); return glob[n] = a, a[o] = t => r(t), [e, `glob['${n}']['${o}'](event)`] } }, c = u, { reduce: i = (t, e) => (c.reduce ? c : Object.entries(c)).reduce(((e, r) => t(e, s(r))), e), [Symbol.iterator]: function* () { yield* i(((t, e) => (t.push(e), t)), []) } })), f = l.map((t => o(t, n, a))); return "Fragment" === r ? f.join("") : `<${r} ${Object.entries(y).map((([t, e]) => void 0 !== e ? `${t}="${e}"` : t)).join(" ")}>${f.join("")}</${r}>` } var i, s, c; return null === e ? "" : r(String(e)) }; class a { constructor(t) { this.x = t } map(t) { return new a(this.x) } } const i = (t, e) => e((t => new a(t)))(t).x; class s { constructor(t) { this.value = t, this.ref = 1, this.watchers = [], this[Symbol.asyncIterator] = async function* () { let t = this.ref; for (yield this.value; ;)t !== this.ref ? (t = this.ref, yield this.value) : await new Promise((t => { this.watchers.push(t) })) } } async notify(t) { const e = "function" == typeof t ? t(this.value) : t; if (e !== this.value) { this.value = e, this.ref += 1; for (const t of this.watchers.splice(0, this.watchers.length)) t(void 0) } } focus(...t) { const e = this; let r = []; return { [Symbol.asyncIterator]: async function* () { for await (const n of e) { const e = t.map((t => i(n, t))); (e.length !== r.length || e.some(((t, e) => t !== r[e]))) && (r = e, yield n) } } } } } Symbol.asyncIterator, (async () => { document.body.innerHTML = o(await n([async function* () { const t = new s(0), e = new s(0), r = setInterval((() => { Math.random() < .5 ? t.notify((t => t + 1)) : e.notify((t => t + 1)) }), 1e3); try { for await (const [r, n] of ((...t) => ({ [Symbol.asyncIterator]: async function* () { const e = t.map((t => t[Symbol.asyncIterator]())), r = await Promise.all(e.map((t => t.next().then((t => t.value))))); yield r; const n = e.map(((t, e) => t.next().then((t => [t.value, e])))); for (; ;) { const [t, o] = await Promise.race(n); r[o] = t, n[o] = e[o].next().then((t => [t.value, o])), yield r } } }))(t, e)) yield ["ul", {}, ["li", {}, `Heads: ${r}`], ["li", {}, `Tails: ${n}`]] } finally { clearInterval(r) } }, {}])) })() })();
  </script>
</body>

</html>