<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        margin: 0px;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <div id="clock"></div>
    <script type="module">
      globalThis.handlers = {}

      // Markup to xml string
      const toXml = (node) => {
        if (Array.isArray(node)) {
          const [tag, props, ...children] = node

          const attributes = Object.entries(props)
            .map(([key, val]) => {
              if (key === "style") {
                val = Object.entries(val)
                  .map(([key, val]) => `${key}: ${val};`)
                  .join(" ")
              } else if (key === "title") {
                val = newlineTooltip(String(val ?? ""))
              } else if (key.startsWith("on")) {
                const id = Math.random().toString(16).slice(2)
                handlers[id] = val
                val = `handlers['${id}'](event)`
              }

              return ` ${key}=${JSON.stringify(String(val))}`
            })
            .join("")
          const mapped = children.map(toXml).join("\n")

          return `<${tag}${attributes}>${mapped}</${tag}>`
        }

        return String(node)
      }

      const render = () => {
        const now = new Date()
        const min = now.getMinutes() - (now.getMinutes() % 5)
        const seg = min > 30 ? 60 - min : min
        let hour = seg < 35 ? now.getHours() : now.getHours() + 1
        if (hour > 12) {
          hour -= 12
        }

        const ON = "orange"
        const OFF = "#666"
        const data = [
          ["IT", true],
          ["R", false],
          ["IS", true],
          ["V", false],
          ["HALF", seg === 30],
          ["D", false],
          ["TWENTY", seg === 20 || seg === 25],
          ["H", false],
          ["FIVE", seg === 5 || seg === 25],
          ["QUARTER", seg === 15],
          ["A", false],
          ["TEN", seg === 10],
          ["PAST", min >= 5 && min < 35],
          ["TO", min >= 35],
          ["R", false],
          ["FOUR", hour === 4],
          ["ONE", hour === 1],
          ["TWO", hour === 2],
          ["THREE", hour === 3],
          ["FIVE", hour === 5],
          ["SIX", hour === 6],
          ["NINE", hour === 9],
          ["TWELVE", hour === 12],
          ["SEVEN", hour === 7],
          ["EIGHT", hour === 8],
          ["ELEVEN", hour === 11],
          ["TEN", hour === 10],
          ["T", false],
          ["O'CLOCK", seg === 0],
        ]

        const M = 0
        const W = window.innerWidth - M
        const H = window.innerHeight - M

        const dx = 36 / 6
        const dy = 8.5

        const root = [
          "svg",
          {
            xmlns: "http://www.w3.org/2000/svg",
            width: Math.min(W, H),
            height: Math.min(W, H),
            "font-family": "Courier New",
            "font-size": 10,
            viewbox: `0 0 ${11 * dx} ${9.4 * dy}`,
          },
        ]

        let x = 0
        let y = 1
        for (const [text, on] of data) {
          root.push([
            "text",
            { x: x * dx, y: y * dy, fill: on ? ON : OFF },
            text,
          ])
          x += text.length
          if (x === 11) {
            x = 0
            y++
          }
        }

        document.getElementById("clock").innerHTML = toXml(root)
      }

      render()
      setInterval(() => {
        render()
      }, 1000)
    </script>
  </body>
</html>
